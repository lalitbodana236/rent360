"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[592],{1312:(h,d,s)=>{s.d(d,{y:()=>o});var i=s(7579),c=s(8256);let o=(()=>{class r{constructor(){this.propertiesChangedSubject=new i.x,this.propertiesChanged$=this.propertiesChangedSubject.asObservable()}notifyPropertiesChanged(){this.propertiesChangedSubject.next()}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=c.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},9125:(h,d,s)=>{s.d(d,{v:()=>M});var i=s(1135),c=s(2843),o=s(9646),r=s(4004),u=s(8505),t=s(2340),l=s(3632),f=s(5523),P=s(8256),v=s(1598),D=s(1312);let M=(()=>{class g{constructor(e,n){this.apiClient=e,this.refresh=n,this.mockStoreKey=l.l,this.state$=new i.X([]),this.initialized=!1}getProperties(){if(this.initialized)return this.state$.asObservable();if(t.N.api.useMockApi){const e=this.readMockStore();if(e)return this.initialized=!0,this.state$.next(this.normalizeProperties(e)),this.state$.asObservable()}return this.apiClient.get({endpoint:f.P.properties.list,mockPath:"properties/units.json"}).pipe((0,r.U)(e=>this.normalizeProperties(e.properties??[])),(0,u.b)(e=>{this.initialized=!0,this.state$.next(e),this.writeMockStore(e),this.refresh.notifyPropertiesChanged()}),(0,r.U)(()=>this.state$.value))}createProperty(e){if(!t.N.api.useMockApi)return this.apiClient.post(f.P.properties.create,e);if(this.isDuplicateProperty(e))return(0,c._)(()=>new Error("Property already exists with same name and address."));const n={id:this.makeId("prop"),name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status,units:[]},p=[n,...this.state$.value];return this.state$.next(p),this.writeMockStore(p),this.refresh.notifyPropertiesChanged(),(0,o.of)(n)}updateProperty(e){if(!t.N.api.useMockApi)return this.apiClient.put(f.P.properties.update(e.id),e);if(this.isDuplicateProperty(e,e.id))return(0,c._)(()=>new Error("Another property already exists with same name and address."));let n;const p=this.state$.value.map(m=>m.id!==e.id?m:(n={...m,name:e.name.trim(),city:e.city.trim(),address:e.address.trim(),description:e.description.trim(),ownerName:e.ownerName.trim(),status:e.status},n));return void 0===n?(0,c._)(()=>new Error("Property not found for update.")):(this.state$.next(p),this.writeMockStore(p),this.refresh.notifyPropertiesChanged(),(0,o.of)(n))}upsertUnit(e){if(!t.N.api.useMockApi)return e.id?this.apiClient.put(f.P.properties.updateUnit(e.propertyId,e.id),e):this.apiClient.post(f.P.properties.createUnit(e.propertyId),e);const n=this.state$.value.find(a=>a.id===e.propertyId);if(!n)return(0,c._)(()=>new Error("Property not found for unit operation."));if(this.isDuplicateUnitCode(n,e.unitCode,e.id))return(0,c._)(()=>new Error("Unit code already exists in this property."));const p=e.media.filter(a=>a.url.trim().length>0).map(a=>({...a,url:a.url.trim(),title:a.title.trim()})),m={id:e.id??this.makeId("unit"),unitCode:e.unitCode.trim(),configuration:e.configuration,type:e.configuration,furnishing:e.furnishing,rent:Number(e.rent)||0,occupancyStatus:e.occupancyStatus,tenantName:e.tenantName.trim(),carpetAreaSqFt:Number(e.carpetAreaSqFt)||0,parking:{twoWheelerSlots:Number(e.parking.twoWheelerSlots)||0,fourWheelerSlots:Number(e.parking.fourWheelerSlots)||0},utilities:{electricityProvider:e.utilities.electricityProvider.trim(),meterNumber:e.utilities.meterNumber.trim(),gasLine:e.utilities.gasLine,waterSupply:e.utilities.waterSupply},media:p},_=this.state$.value.map(a=>{if(a.id!==e.propertyId)return a;const C=a.units.findIndex(O=>O.id===m.id);if(-1===C)return{...a,units:[...a.units,m]};const E=[...a.units];return E[C]=m,{...a,units:E}});return this.state$.next(_),this.writeMockStore(_),this.refresh.notifyPropertiesChanged(),(0,o.of)(m)}isDuplicateProperty(e,n=""){const p=this.norm(e.name),m=this.norm(e.city),_=this.norm(e.address);return this.state$.value.some(a=>(!n||a.id!==n)&&this.norm(a.name)===p&&this.norm(a.city)===m&&this.norm(a.address)===_)}isDuplicateUnitCode(e,n,p=""){const m=this.norm(n);return e.units.some(_=>(!p||_.id!==p)&&this.norm(_.unitCode)===m)}norm(e){return(e??"").trim().toLowerCase()}normalizeProperties(e){return e.map(n=>({...n,address:n.address??"",description:n.description??"",units:(n.units??[]).map(p=>this.normalizeUnit(p))}))}normalizeUnit(e){const n=e.configuration??e.type??"1BHK",p=e.furnishing??"unfurnished";return{...e,configuration:n,type:e.type??n,furnishing:p,carpetAreaSqFt:Number(e.carpetAreaSqFt??0),parking:{twoWheelerSlots:Number(e.parking?.twoWheelerSlots??0),fourWheelerSlots:Number(e.parking?.fourWheelerSlots??0)},utilities:{electricityProvider:e.utilities?.electricityProvider??"",meterNumber:e.utilities?.meterNumber??"",gasLine:e.utilities?.gasLine??"no",waterSupply:e.utilities?.waterSupply??"corporation"},media:(e.media??[]).map((m,_)=>({id:m.id??`${e.id}-media-${_+1}`,type:m.type,url:m.url,title:m.title??""}))}}makeId(e){return`${e}-${Date.now()}-${Math.floor(1e3*Math.random())}`}readMockStore(){try{const e=localStorage.getItem(this.mockStoreKey);if(!e)return null;const n=JSON.parse(e);return Array.isArray(n)?n:null}catch{return null}}writeMockStore(e){if(t.N.api.useMockApi)try{localStorage.setItem(this.mockStoreKey,JSON.stringify(e))}catch{}}}return g.\u0275fac=function(e){return new(e||g)(P.LFG(v.O),P.LFG(D.y))},g.\u0275prov=P.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},9219:(h,d,s)=>{s.d(d,{A:()=>o});var i=s(8256);const c=["*"];let o=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=i.Xpm({type:r,selectors:[["r360-card"]],hostAttrs:[1,"block"],ngContentSelectors:c,decls:2,vars:0,consts:[[1,"r360-card"]],template:function(t,l){1&t&&(i.F$t(),i.TgZ(0,"div",0),i.Hsn(1),i.qZA())},encapsulation:2}),r})()},2802:(h,d,s)=>{s.d(d,{q:()=>c});var i=s(8256);let c=(()=>{class o{constructor(){this.title="",this.subtitle=""}}return o.\u0275fac=function(u){return new(u||o)},o.\u0275cmp=i.Xpm({type:o,selectors:[["r360-page-header"]],inputs:{title:"title",subtitle:"subtitle"},decls:5,vars:2,consts:[[1,"r360-page-header"],[1,"r360-page-title"],[1,"r360-page-subtitle"]],template:function(u,t){1&u&&(i.TgZ(0,"div",0)(1,"h1",1),i._uU(2),i.qZA(),i.TgZ(3,"p",2),i._uU(4),i.qZA()()),2&u&&(i.xp6(2),i.Oqu(t.title),i.xp6(2),i.Oqu(t.subtitle))},encapsulation:2}),o})()},5213:(h,d,s)=>{s.d(d,{e:()=>o});var i=s(8256),c=s(6895);let o=(()=>{class r{constructor(){this.value=""}get classes(){const t=this.value.toLowerCase();return t.includes("paid")||t.includes("active")?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-200":t.includes("late")||t.includes("warning")?"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-200":t.includes("due")||t.includes("danger")?"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-200":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200"}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=i.Xpm({type:r,selectors:[["r360-status-badge"]],inputs:{value:"value"},decls:2,vars:2,consts:[[1,"rounded-lg","px-3","py-1","text-xs","font-semibold",3,"ngClass"]],template:function(t,l){1&t&&(i.TgZ(0,"span",0),i._uU(1),i.qZA()),2&t&&(i.Q6J("ngClass",l.classes),i.xp6(1),i.Oqu(l.value))},dependencies:[c.mk],encapsulation:2}),r})()},8821:(h,d,s)=>{s.d(d,{I:()=>o});var i=s(8256),c=s(7338);let o=(()=>{class r{constructor(t){this.settings=t,this.currency="USD",this.locale="en-US",this.settings.userSettings$.subscribe(l=>{this.currency=l.currency,this.locale="hi"===l.language?"hi-IN":"en-US"})}transform(t){return new Intl.NumberFormat(this.locale,{style:"currency",currency:this.currency,maximumFractionDigits:2}).format(t)}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(c.s,16))},r.\u0275pipe=i.Yjl({name:"appCurrency",type:r,pure:!1}),r})()},217:(h,d,s)=>{s.d(d,{G:()=>o});var i=s(8256),c=s(7338);let o=(()=>{class r{constructor(t){this.settings=t,this.locale="en-US",this.timeZone="America/New_York",this.timeFormat="12h",this.settings.userSettings$.subscribe(l=>{this.locale="hi"===l.language?"hi-IN":"en-US",this.timeZone=l.timeZone,this.timeFormat=l.timeFormat})}transform(t){const l=new Date(t);return Number.isNaN(l.getTime())?String(t):new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:"12h"===this.timeFormat,timeZone:this.timeZone}).format(l)}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(c.s,16))},r.\u0275pipe=i.Yjl({name:"appDate",type:r,pure:!1}),r})()}}]);