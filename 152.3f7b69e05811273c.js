"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[152],{5152:(me,y,a)=>{a.r(y),a.d(y,{SettingsModule:()=>ce});var g=a(5675),f=a(8327),S=a(7574),N=a(4466),I=a(9646),w=a(5698),q=a(727);class k extends q.w0{constructor(s,t){super()}schedule(s,t=0){return this}}const p={setInterval(n,s,...t){const{delegate:r}=p;return r?.setInterval?r.setInterval(n,s,...t):setInterval(n,s,...t)},clearInterval(n){const{delegate:s}=p;return(s?.clearInterval||clearInterval)(n)},delegate:void 0};var O=a(8737);const T={now:()=>(T.delegate||Date).now(),delegate:void 0};class d{constructor(s,t=d.now){this.schedulerActionCtor=s,this.now=t}schedule(s,t=0,r){return new this.schedulerActionCtor(this,s).schedule(r,t)}}d.now=T.now;const E=new class M extends d{constructor(s,t=d.now){super(s,t),this.actions=[],this._active=!1}flush(s){const{actions:t}=this;if(this._active)return void t.push(s);let r;this._active=!0;do{if(r=s.execute(s.state,s.delay))break}while(s=t.shift());if(this._active=!1,r){for(;s=t.shift();)s.unsubscribe();throw r}}}(class P extends k{constructor(s,t){super(s,t),this.scheduler=s,this.work=t,this.pending=!1}schedule(s,t=0){var r;if(this.closed)return this;this.state=s;const o=this.id,l=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(l,o,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(l,this.id,t),this}requestAsyncId(s,t,r=0){return p.setInterval(s.flush.bind(s,this),r)}recycleAsyncId(s,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&p.clearInterval(t)}execute(s,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(s,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,t){let o,r=!1;try{this.work(s)}catch(l){r=!0,o=l||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:s,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,O.P)(r,this),null!=s&&(this.id=this.recycleAsyncId(t,s,null)),this.delay=null,super.unsubscribe()}}});var J=a(4482),z=a(8421),Y=a(3888),D=a(5403),L=a(9672);const R=(0,Y.d)(n=>function(t=null){n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t});function G(n){throw new R(n)}var W=a(262),B=a(8746),e=a(8256),K=a(263),x=a(1438),h=a(6895),i=a(4006),v=a(9219);function V(n,s){1&n&&(e.TgZ(0,"section",0)(1,"r360-card"),e._uU(2,"Loading permission manager..."),e.qZA()())}function j(n,s){if(1&n&&(e.TgZ(0,"section",0)(1,"r360-card")(2,"div",3),e._uU(3),e.qZA()()()),2&n){const t=e.oxw();e.xp6(3),e.Oqu(t.error)}}function H(n,s){1&n&&(e.TgZ(0,"section",0)(1,"r360-card")(2,"div",1),e._uU(3," You can view settings, but only users with authorization management permission can change access rules. "),e.qZA()()())}function X(n,s){if(1&n&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.email),e.xp6(1),e.AsE(" ",t.fullName," (",t.email,") ")}}function $(n,s){if(1&n&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.label," ")}}function ee(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"tr",22)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",23),e._uU(4),e.qZA(),e.TgZ(5,"td",23),e._uU(6),e.qZA(),e.TgZ(7,"td",23)(8,"select",24),e.NdJ("ngModelChange",function(o){const m=e.CHM(t).$implicit,Z=e.oxw().ngIf,c=e.oxw(2);return e.KtG(c.setOverride(Z,m.key,o))}),e.TgZ(9,"option",25),e._uU(10,"Inherit Role Default"),e.qZA(),e.YNc(11,$,2,2,"option",7),e.qZA()()()}if(2&n){const t=s.$implicit,r=e.oxw().ngIf,o=e.oxw(2);e.xp6(2),e.Oqu(t.group),e.xp6(2),e.Oqu(t.label),e.xp6(2),e.Oqu(o.currentAccess(r,t.key)),e.xp6(2),e.Q6J("ngModel",o.currentOverride(r,t.key)),e.xp6(3),e.Q6J("ngForOf",o.accessOptions)}}function te(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",14)(2,"h3",15),e._uU(3," Permission Overrides "),e.qZA(),e.TgZ(4,"button",16),e.NdJ("click",function(){const l=e.CHM(t).ngIf,m=e.oxw(2);return e.KtG(m.resetUser(l))}),e._uU(5," Reset User Overrides "),e.qZA()(),e.TgZ(6,"div",17)(7,"table",18)(8,"thead")(9,"tr",19)(10,"th",20),e._uU(11,"Feature Group"),e.qZA(),e.TgZ(12,"th",20),e._uU(13,"Permission"),e.qZA(),e.TgZ(14,"th",20),e._uU(15,"Effective Access"),e.qZA(),e.TgZ(16,"th",20),e._uU(17,"Override"),e.qZA()()(),e.TgZ(18,"tbody"),e.YNc(19,ee,12,5,"tr",21),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(19),e.Q6J("ngForOf",t.permissionRows)("ngForTrackBy",t.trackByPermission)}}function ne(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"section",0)(1,"r360-card")(2,"div",4)(3,"label",5),e._uU(4," Select User "),e.TgZ(5,"select",6),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.selectUser(o))}),e.YNc(6,X,2,3,"option",7),e.qZA()(),e.TgZ(7,"div",8)(8,"div",9),e._uU(9,"Assigned Roles"),e.qZA(),e.TgZ(10,"div",10),e._uU(11),e.qZA()()(),e.YNc(12,te,20,2,"div",11),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.selectedUserEmail),e.xp6(1),e.Q6J("ngForOf",t.users),e.xp6(5),e.hij(" ",t.getRoleList(t.selectedUser)," "),e.xp6(1),e.Q6J("ngIf",t.selectedUser)}}let re=(()=>{class n{constructor(t,r){this.auth=t,this.authorization=r,this.accessOptions=[{value:"hidden",label:"Hidden"},{value:"read",label:"Read"},{value:"write",label:"Write"}],this.users=[],this.selectedUser=null,this.selectedUserEmail="",this.canManageAuthorization=!1,this.loading=!0,this.error="",this.permissionRows=[],this.permissionRows=this.authorization.getEnabledPermissions().map(({key:o,definition:l})=>({key:o,label:l.label??o,group:l.group??"General"})).sort((o,l)=>o.group===l.group?o.label.localeCompare(l.label):o.group.localeCompare(l.group))}ngOnInit(){this.canManageAuthorization=this.authorization.canWrite(f._.authorizationManage),this.auth.listUsers().pipe((0,w.q)(1),function Q(n,s){const{first:t,each:r,with:o=G,scheduler:l=s??E,meta:m=null}=function F(n){return n instanceof Date&&!isNaN(n)}(n)?{first:n}:"number"==typeof n?{each:n}:n;if(null==t&&null==r)throw new TypeError("No timeout provided.");return(0,J.e)((Z,c)=>{let _,u,A=null,b=0;const C=U=>{u=(0,L.f)(c,l,()=>{try{_.unsubscribe(),(0,z.Xf)(o({meta:m,lastValue:A,seen:b})).subscribe(c)}catch(de){c.error(de)}},U)};_=Z.subscribe((0,D.x)(c,U=>{u?.unsubscribe(),b++,c.next(A=U),r>0&&C(r)},void 0,void 0,()=>{u?.closed||u?.unsubscribe(),A=null})),!b&&C(null!=t?"number"==typeof t?t:+t-l.now():r)})}(8e3),(0,W.K)(()=>(this.error="Failed to load users for permission management.",(0,I.of)([]))),(0,B.x)(()=>{this.loading=!1})).subscribe(t=>{this.users=t,t.length&&(this.selectedUserEmail=t[0].email,this.selectedUser=t[0])})}selectUser(t){this.selectedUserEmail=t,this.selectedUser=this.users.find(r=>r.email===t)??null}trackByPermission(t,r){return r.key}getRoleList(t){return t?t.roles.join(", "):"-"}currentAccess(t,r){return this.authorization.getAccessLevelForUser(t,r)}currentOverride(t,r){return this.authorization.getUserOverride(t.email,r)??""}setOverride(t,r,o){this.authorization.setUserOverride(t.email,r,o||null)}resetUser(t){this.authorization.clearUserOverrides(t.email)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(K.e),e.Y36(x.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-settings-permissions"]],decls:8,vars:4,consts:[[1,"r360-section"],[1,"text-sm","text-gray-600","dark:text-gray-300"],["class","r360-section",4,"ngIf"],[1,"text-sm","text-danger"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-2"],[1,"r360-label"],[1,"r360-input","mt-1",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"rounded-lg","border","border-gray-200","p-3","dark:border-gray-700"],[1,"text-xs","uppercase","tracking-wide","text-gray-500"],[1,"mt-2","text-sm","text-gray-700","dark:text-gray-200"],["class","mt-4",4,"ngIf"],[3,"value"],[1,"mt-4"],[1,"mb-3","flex","items-center","justify-between"],[1,"text-base","font-semibold","text-gray-900","dark:text-gray-100"],["type","button",1,"r360-btn-secondary",3,"click"],[1,"r360-table-wrap"],[1,"r360-table"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"r360-th"],["class","r360-row",4,"ngFor","ngForOf","ngForTrackBy"],[1,"r360-row"],[1,"r360-td"],[1,"r360-input",3,"ngModel","ngModelChange"],["value",""]],template:function(t,r){1&t&&(e.TgZ(0,"section",0)(1,"r360-card")(2,"div",1),e._uU(3," Role permissions are defaults. Per-user overrides below can grant or revoke specific permissions centrally. "),e.qZA()()(),e.YNc(4,V,3,0,"section",2),e.YNc(5,j,4,1,"section",2),e.YNc(6,H,4,0,"section",2),e.YNc(7,ne,13,4,"section",2)),2&t&&(e.xp6(4),e.Q6J("ngIf",r.loading),e.xp6(1),e.Q6J("ngIf",!r.loading&&r.error),e.xp6(1),e.Q6J("ngIf",!r.loading&&!r.error&&!r.canManageAuthorization),e.xp6(1),e.Q6J("ngIf",!r.loading&&!r.error&&r.canManageAuthorization))},dependencies:[h.sg,h.O5,i.YN,i.Kr,i.EJ,i.JJ,i.On,v.A],styles:[".r360-table[_ngcontent-%COMP%]   .r360-input[_ngcontent-%COMP%]{min-width:180px}"]}),n})();var se=a(7338);function ie(n,s){1&n&&(e.TgZ(0,"span",41),e._uU(1,"Saved"),e.qZA())}let oe=(()=>{class n{constructor(t,r){this.fb=t,this.userSettings=r,this.saved=!1,this.form=this.fb.group({fullName:["",[i.kI.required,i.kI.minLength(2)]],email:["",[i.kI.required,i.kI.email]],mobileNumber:["",[i.kI.required,i.kI.minLength(5)]],address:["",[i.kI.required,i.kI.minLength(5)]],currency:["USD",i.kI.required],defaultDashboard:["owner",i.kI.required],timeFormat:["12h",i.kI.required],timeZone:["America/New_York",i.kI.required],language:["en",i.kI.required],notifyEmail:[!0],notifyWhatsApp:[!1],notifyInApp:[!0],whatsAppNumber:[""]})}ngOnInit(){this.form.patchValue({...this.userSettings.snapshot})}save(){if(this.form.invalid)return void this.form.markAllAsTouched();const t=this.form.getRawValue();this.userSettings.updateSettings({fullName:t.fullName??"",email:t.email??"",mobileNumber:t.mobileNumber??"",address:t.address??"",currency:t.currency??"USD",defaultDashboard:t.defaultDashboard??"owner",timeFormat:t.timeFormat??"12h",timeZone:t.timeZone??"America/New_York",language:t.language??"en",notifyEmail:t.notifyEmail??!0,notifyWhatsApp:t.notifyWhatsApp??!1,notifyInApp:t.notifyInApp??!0,whatsAppNumber:t.whatsAppNumber??""}),this.saved=!0,setTimeout(()=>{this.saved=!1},2e3)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(i.qu),e.Y36(se.s))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-settings-user"]],decls:86,vars:2,consts:[[1,"r360-section"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-2",3,"formGroup","ngSubmit"],[1,"r360-label"],["formControlName","fullName","type","text",1,"r360-input","mt-1"],["formControlName","email","type","email",1,"r360-input","mt-1"],["formControlName","mobileNumber","type","text",1,"r360-input","mt-1"],["formControlName","whatsAppNumber","type","text",1,"r360-input","mt-1"],[1,"r360-label","lg:col-span-2"],["formControlName","address","type","text",1,"r360-input","mt-1"],["formControlName","currency",1,"r360-input","mt-1"],["value","USD"],["value","INR"],["value","EUR"],["value","GBP"],["value","AED"],["formControlName","defaultDashboard",1,"r360-input","mt-1"],["value","owner"],["value","tenant"],["formControlName","timeFormat",1,"r360-input","mt-1"],["value","12h"],["value","24h"],["formControlName","timeZone",1,"r360-input","mt-1"],["value","America/New_York"],["value","America/Chicago"],["value","America/Denver"],["value","America/Los_Angeles"],["value","Asia/Kolkata"],["formControlName","language",1,"r360-input","mt-1"],["value","en"],["value","hi"],[1,"lg:col-span-2"],[1,"text-sm","font-semibold","text-gray-800","dark:text-gray-100"],[1,"mt-2","grid","grid-cols-1","gap-2","sm:grid-cols-3"],[1,"r360-checkbox"],["type","checkbox","formControlName","notifyEmail"],["type","checkbox","formControlName","notifyWhatsApp"],["type","checkbox","formControlName","notifyInApp"],[1,"lg:col-span-2","flex","items-center","gap-3"],["type","submit",1,"r360-btn-primary"],["class","text-sm text-green-600",4,"ngIf"],[1,"text-sm","text-green-600"]],template:function(t,r){1&t&&(e.TgZ(0,"section",0)(1,"r360-card")(2,"div",1),e._uU(3," Update your profile and personal preferences. These values are used in your app experience. "),e.qZA()()(),e.TgZ(4,"section",0)(5,"r360-card")(6,"form",2),e.NdJ("ngSubmit",function(){return r.save()}),e.TgZ(7,"label",3),e._uU(8," Full Name "),e._UZ(9,"input",4),e.qZA(),e.TgZ(10,"label",3),e._uU(11," Email "),e._UZ(12,"input",5),e.qZA(),e.TgZ(13,"label",3),e._uU(14," Mobile Number "),e._UZ(15,"input",6),e.qZA(),e.TgZ(16,"label",3),e._uU(17," WhatsApp Number "),e._UZ(18,"input",7),e.qZA(),e.TgZ(19,"label",8),e._uU(20," Address "),e._UZ(21,"input",9),e.qZA(),e.TgZ(22,"label",3),e._uU(23," Currency "),e.TgZ(24,"select",10)(25,"option",11),e._uU(26,"USD"),e.qZA(),e.TgZ(27,"option",12),e._uU(28,"INR"),e.qZA(),e.TgZ(29,"option",13),e._uU(30,"EUR"),e.qZA(),e.TgZ(31,"option",14),e._uU(32,"GBP"),e.qZA(),e.TgZ(33,"option",15),e._uU(34,"AED"),e.qZA()()(),e.TgZ(35,"label",3),e._uU(36," Default Dashboard "),e.TgZ(37,"select",16)(38,"option",17),e._uU(39,"Owner"),e.qZA(),e.TgZ(40,"option",18),e._uU(41,"Tenant"),e.qZA()()(),e.TgZ(42,"label",3),e._uU(43," Time Format "),e.TgZ(44,"select",19)(45,"option",20),e._uU(46,"12-hour"),e.qZA(),e.TgZ(47,"option",21),e._uU(48,"24-hour"),e.qZA()()(),e.TgZ(49,"label",3),e._uU(50," Time Zone "),e.TgZ(51,"select",22)(52,"option",23),e._uU(53,"America/New_York"),e.qZA(),e.TgZ(54,"option",24),e._uU(55,"America/Chicago"),e.qZA(),e.TgZ(56,"option",25),e._uU(57,"America/Denver"),e.qZA(),e.TgZ(58,"option",26),e._uU(59,"America/Los_Angeles"),e.qZA(),e.TgZ(60,"option",27),e._uU(61,"Asia/Kolkata"),e.qZA()()(),e.TgZ(62,"label",3),e._uU(63," Language "),e.TgZ(64,"select",28)(65,"option",29),e._uU(66,"English"),e.qZA(),e.TgZ(67,"option",30),e._uU(68,"Hindi"),e.qZA()()(),e.TgZ(69,"div",31)(70,"div",32),e._uU(71,"Notification Preferences"),e.qZA(),e.TgZ(72,"div",33)(73,"label",34),e._UZ(74,"input",35),e._uU(75," Email "),e.qZA(),e.TgZ(76,"label",34),e._UZ(77,"input",36),e._uU(78," WhatsApp "),e.qZA(),e.TgZ(79,"label",34),e._UZ(80,"input",37),e._uU(81," In-App "),e.qZA()()(),e.TgZ(82,"div",38)(83,"button",39),e._uU(84,"Save User Settings"),e.qZA(),e.YNc(85,ie,2,0,"span",40),e.qZA()()()()),2&t&&(e.xp6(6),e.Q6J("formGroup",r.form),e.xp6(79),e.Q6J("ngIf",r.saved))},dependencies:[h.O5,i._Y,i.YN,i.Kr,i.Fj,i.Wl,i.EJ,i.JJ,i.JL,i.sg,i.u,v.A],styles:[".r360-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:#374151}"]}),n})();var ae=a(2802);function le(n,s){1&n&&(e.TgZ(0,"a",7),e._uU(1," Permissions "),e.qZA())}const ue=[{path:"",component:(()=>{class n{constructor(t){this.authorization=t,this.canViewPermissions=this.authorization.canView(f._.authorizationManage)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-settings"]],decls:9,vars:1,consts:[[1,"r360-page"],["title","Settings","subtitle","Manage profile preferences and centralized access controls"],[1,"r360-section"],[1,"settings-tabs-card"],[1,"settings-tabs"],["routerLink","user","routerLinkActive","settings-tab-active",1,"settings-tab"],["routerLink","permissions","routerLinkActive","settings-tab-active","class","settings-tab",4,"ngIf"],["routerLink","permissions","routerLinkActive","settings-tab-active",1,"settings-tab"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"r360-page-header",1),e.TgZ(2,"section",2)(3,"r360-card",3)(4,"nav",4)(5,"a",5),e._uU(6," User Settings "),e.qZA(),e.YNc(7,le,2,0,"a",6),e.qZA()()(),e._UZ(8,"router-outlet"),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngIf",r.canViewPermissions))},dependencies:[h.O5,v.A,ae.q,g.lC,g.yS,g.Od],styles:[".settings-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.settings-tab[_ngcontent-%COMP%]{border:1px solid rgb(229,231,235);border-radius:.75rem;padding:.5rem .875rem;font-size:.875rem;font-weight:600;color:#4b5563;text-decoration:none}.settings-tab[_ngcontent-%COMP%]:hover{background:rgb(249,250,251)}.settings-tab-active[_ngcontent-%COMP%]{background:rgb(30,64,175);border-color:#1e40af;color:#fff}"]}),n})(),children:[{path:"",redirectTo:"user",pathMatch:"full"},{path:"user",component:oe},{path:"permissions",component:re,canActivate:[S.a],data:{permission:f._.authorizationManage}}]}];let ce=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[N.m,g.Bz.forChild(ue)]}),n})()}}]);