"use strict";(self.webpackChunkrent360=self.webpackChunkrent360||[]).push([[325],{5325:(L,l,i)=>{i.r(l),i.d(l,{TenantsModule:()=>F});var m=i(5675),Z=i(4466),f=i(727),c=i(8327),t=i(8256),A=i(263),y=i(1438),x=i(9125),p=i(6895),d=i(4006),v=i(9219),_=i(2802),U=i(8821),b=i(217);function q(a,o){if(1&a&&(t.TgZ(0,"option",24),t._uU(1),t.qZA()),2&a){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function C(a,o){1&a&&(t.TgZ(0,"button",39),t._uU(1,"Contact"),t.qZA())}function O(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"section",7)(1,"r360-card")(2,"div",25)(3,"h3",26),t._uU(4,"Tenant Snapshot"),t.qZA(),t.TgZ(5,"button",27),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.closeTenant())}),t._uU(6,"Close"),t.qZA()(),t.TgZ(7,"div",28)(8,"div",29)(9,"div",3),t._uU(10,"Tenant"),t.qZA(),t.TgZ(11,"div",30),t._uU(12),t.qZA(),t.TgZ(13,"div",31),t._uU(14),t.qZA(),t.TgZ(15,"div",32),t._uU(16),t.qZA()(),t.TgZ(17,"div",29)(18,"div",3),t._uU(19,"Financial"),t.qZA(),t.TgZ(20,"div",33)(21,"span",34),t._uU(22,"Rent:"),t.qZA(),t._uU(23),t.ALo(24,"appCurrency"),t.qZA(),t.TgZ(25,"div",35)(26,"span",34),t._uU(27,"Pending:"),t.qZA(),t._uU(28),t.ALo(29,"appCurrency"),t.qZA(),t.TgZ(30,"div",35)(31,"span",34),t._uU(32,"Lease End:"),t.qZA(),t._uU(33),t.ALo(34,"appDate"),t.qZA()(),t.TgZ(35,"div",29)(36,"div",3),t._uU(37,"Owner & Action"),t.qZA(),t.TgZ(38,"div",33)(39,"span",34),t._uU(40,"Owner:"),t.qZA(),t._uU(41),t.qZA(),t.TgZ(42,"div",35)(43,"span",34),t._uU(44,"Status:"),t.qZA(),t._uU(45),t.qZA(),t.TgZ(46,"div",36),t.YNc(47,C,2,0,"button",37),t.TgZ(48,"button",38),t._uU(49),t.qZA()()()()()()}if(2&a){const e=o.ngIf,n=t.oxw();t.xp6(12),t.Oqu(e.name),t.xp6(2),t.AsE("Unit ",e.unit,", ",e.property,""),t.xp6(2),t.Oqu(e.city),t.xp6(7),t.hij(" ",t.lcZ(24,11,e.rent),""),t.xp6(5),t.hij(" ",t.lcZ(29,13,e.pendingDues),""),t.xp6(5),t.hij(" ",t.lcZ(34,15,e.leaseEnd),""),t.xp6(8),t.hij(" ",e.ownerName,""),t.xp6(4),t.hij(" ",e.status,""),t.xp6(2),t.Q6J("ngIf",n.canManageTenantActions),t.xp6(2),t.Oqu(n.canManageTenantActions?"Open Ledger":"View My Ledger")}}function w(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw();return t.KtG(r.openTenant(s))}),t._uU(1),t.qZA()}if(2&a){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.canManageTenantActions?"Manage":"View"," ")}}function S(a,o){1&a&&(t.TgZ(0,"span",45),t._uU(1,"No access"),t.qZA())}function D(a,o){if(1&a&&(t.TgZ(0,"tr",40)(1,"td",41),t._uU(2),t.qZA(),t.TgZ(3,"td",41),t._uU(4),t.qZA(),t.TgZ(5,"td",41),t._uU(6),t.qZA(),t.TgZ(7,"td",41),t._uU(8),t.ALo(9,"appCurrency"),t.qZA(),t.TgZ(10,"td",41),t._uU(11),t.ALo(12,"appCurrency"),t.qZA(),t.TgZ(13,"td",41),t._uU(14),t.ALo(15,"appDate"),t.qZA(),t.TgZ(16,"td",41)(17,"span",42),t._uU(18),t.qZA()(),t.TgZ(19,"td",41),t.YNc(20,w,2,1,"button",43),t.YNc(21,S,2,0,"span",44),t.qZA()()),2&a){const e=o.$implicit,n=t.oxw();t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.property),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(t.lcZ(9,13,e.rent)),t.xp6(3),t.Oqu(t.lcZ(12,15,e.pendingDues)),t.xp6(3),t.Oqu(t.lcZ(15,17,e.leaseEnd)),t.xp6(3),t.ekj("tenant-chip-warning","Due Soon"===e.status)("tenant-chip-danger","Overdue"===e.status),t.xp6(1),t.hij(" ",e.status," "),t.xp6(2),t.Q6J("ngIf",n.canViewTenantActions),t.xp6(1),t.Q6J("ngIf",!n.canViewTenantActions)}}function M(a,o){1&a&&(t.TgZ(0,"tr",40)(1,"td",46),t._uU(2,"No tenant records are available for your current role and filters."),t.qZA()())}const N=[{path:"",component:(()=>{class a{constructor(e,n,s){this.auth=e,this.authorization=n,this.propertiesData=s,this.search="",this.selectedProperty="All",this.selectedStatus="All",this.selectedTenant=null,this.allTenants=[],this.filteredTenants=[],this.subscriptions=new f.w0}ngOnInit(){this.subscriptions.add(this.propertiesData.getProperties().subscribe(e=>{this.allTenants=this.buildTenantRows(e),this.applyFilters()}))}ngOnDestroy(){this.subscriptions.unsubscribe()}get subtitle(){return this.isSocietyAdmin||this.isAdmin?"Central member tenant view with dues and lease health":this.isOwner?"Tenants across your owned properties":this.isTenant?"Your tenancy details, dues, and lease timeline":"Tenant profile, tenancy history and status"}get totalTenants(){return this.filteredTenants.length}get overdueTenants(){return this.filteredTenants.filter(e=>"Overdue"===e.status).length}get dueSoonTenants(){return this.filteredTenants.filter(e=>"Due Soon"===e.status).length}get pendingDuesTotal(){return this.filteredTenants.reduce((e,n)=>e+n.pendingDues,0)}get propertyOptions(){return["All",...Array.from(new Set(this.allTenants.map(e=>e.property)))]}get canManageTenantActions(){return this.authorization.canWrite(c._.tenantsWrite)}get canViewTenantActions(){return this.authorization.canView(c._.tenantsView)}onSearch(e){this.search=e,this.applyFilters()}onPropertyFilter(e){this.selectedProperty=e,this.applyFilters()}onStatusFilter(e){this.selectedStatus=e,this.applyFilters()}openTenant(e){this.selectedTenant=e}closeTenant(){this.selectedTenant=null}get currentUserName(){return(this.auth.snapshotUser?.fullName??"").trim().toLowerCase()}get isAdmin(){return this.auth.snapshotUser?.roles.includes("admin")??!1}get isSocietyAdmin(){return this.auth.snapshotUser?.roles.includes("societyAdmin")??!1}get isOwner(){return this.auth.snapshotUser?.roles.includes("owner")??!1}get isTenant(){return this.auth.snapshotUser?.roles.includes("tenant")??!1}buildTenantRows(e){const n=e.flatMap(s=>s.units.filter(r=>r.tenantName?.trim().length>0).map(r=>{const u=`${s.id}-${r.id}`,g=this.hashCode(u),h=this.leaseEndDate(g),T=this.pendingDueAmount(r.rent,g),J=this.healthStatus(T,h);return{id:u,name:r.tenantName.trim(),property:s.name,unit:r.unitCode,city:s.city,ownerName:s.ownerName,rent:r.rent,leaseEnd:h,pendingDues:T,status:J,occupancy:r.occupancyStatus}}));return this.scopeByRole(n)}scopeByRole(e){if(this.isAdmin||this.isSocietyAdmin)return e;const n=new Map,s=this.currentUserName;return this.isOwner&&s&&e.filter(r=>r.ownerName.toLowerCase().split(",").map(u=>u.trim()).includes(s)).forEach(r=>n.set(r.id,r)),this.isTenant&&s&&e.filter(r=>r.name.toLowerCase()===s).forEach(r=>n.set(r.id,r)),Array.from(n.values())}applyFilters(){const e=this.search.trim().toLowerCase();this.filteredTenants=this.allTenants.filter(n=>"All"===this.selectedProperty||n.property===this.selectedProperty).filter(n=>"All"===this.selectedStatus||n.status===this.selectedStatus).filter(n=>!e||[n.name,n.property,n.unit,n.city,n.ownerName].join(" ").toLowerCase().includes(e))}pendingDueAmount(e,n){const s=Math.abs(n%4);return 0===s?0:Math.round(1===s?.1*e:2===s?.2*e:.35*e)}healthStatus(e,n){if(e>0)return e>500?"Overdue":"Due Soon";const s=new Date(n).getTime(),r=Date.now();return Math.round((s-r)/864e5)<=30?"Due Soon":"On Track"}leaseEndDate(e){const n=new Date,s=1+Math.abs(e%18);return new Date(n.getFullYear(),n.getMonth()+s,5+Math.abs(e%20)).toISOString().split("T")[0]}hashCode(e){let n=0;for(let s=0;s<e.length;s+=1)n=(n<<5)-n+e.charCodeAt(s),n|=0;return n}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(A.e),t.Y36(y.Z),t.Y36(x.v))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-tenants"]],decls:71,vars:14,consts:[[1,"r360-page"],["title","Tenants",3,"subtitle"],[1,"r360-section","grid","grid-cols-1","gap-4","sm:grid-cols-2","xl:grid-cols-4"],[1,"text-xs","uppercase","tracking-wide","text-gray-500"],[1,"mt-2","text-3xl","font-bold","text-gray-900","dark:text-gray-100"],[1,"mt-2","text-3xl","font-bold","text-warning"],[1,"mt-2","text-3xl","font-bold","text-danger"],[1,"r360-section"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-3"],[1,"r360-label"],["type","text","placeholder","Tenant, property, unit, owner",1,"r360-input","mt-1",3,"value","input"],[1,"r360-input","mt-1",3,"value","change"],[3,"value",4,"ngFor","ngForOf"],["value","All"],["value","On Track"],["value","Due Soon"],["value","Overdue"],["class","r360-section",4,"ngIf"],[1,"r360-table-wrap"],[1,"r360-table"],[1,"border-b","border-gray-200","dark:border-gray-700"],[1,"r360-th"],["class","r360-row",4,"ngFor","ngForOf"],["class","r360-row",4,"ngIf"],[3,"value"],[1,"mb-4","flex","items-center","justify-between"],[1,"text-lg","font-semibold"],["type","button",1,"r360-btn-secondary",3,"click"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-3"],[1,"r360-panel"],[1,"mt-2","text-xl","font-semibold"],[1,"mt-2","text-sm","text-gray-600","dark:text-gray-300"],[1,"mt-1","text-sm","text-gray-600","dark:text-gray-300"],[1,"mt-2","text-sm"],[1,"font-semibold"],[1,"mt-1","text-sm"],[1,"mt-3","flex","flex-wrap","gap-2"],["class","r360-btn-secondary","type","button",4,"ngIf"],["type","button",1,"r360-btn-primary"],["type","button",1,"r360-btn-secondary"],[1,"r360-row"],[1,"r360-td"],[1,"tenant-chip"],["class","r360-btn-secondary","type","button",3,"click",4,"ngIf"],["class","text-xs text-gray-500",4,"ngIf"],[1,"text-xs","text-gray-500"],["colspan","8",1,"r360-td","text-sm","text-gray-500"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"r360-page-header",1),t.TgZ(2,"section",2)(3,"r360-card")(4,"div",3),t._uU(5,"Visible Tenants"),t.qZA(),t.TgZ(6,"div",4),t._uU(7),t.qZA()(),t.TgZ(8,"r360-card")(9,"div",3),t._uU(10,"Due Soon"),t.qZA(),t.TgZ(11,"div",5),t._uU(12),t.qZA()(),t.TgZ(13,"r360-card")(14,"div",3),t._uU(15,"Overdue"),t.qZA(),t.TgZ(16,"div",6),t._uU(17),t.qZA()(),t.TgZ(18,"r360-card")(19,"div",3),t._uU(20,"Pending Dues"),t.qZA(),t.TgZ(21,"div",4),t._uU(22),t.ALo(23,"appCurrency"),t.qZA()()(),t.TgZ(24,"section",7)(25,"r360-card")(26,"div",8)(27,"label",9),t._uU(28," Search "),t.TgZ(29,"input",10),t.NdJ("input",function(r){return n.onSearch(r.target.value)}),t.qZA()(),t.TgZ(30,"label",9),t._uU(31," Property "),t.TgZ(32,"select",11),t.NdJ("change",function(r){return n.onPropertyFilter(r.target.value)}),t.YNc(33,q,2,2,"option",12),t.qZA()(),t.TgZ(34,"label",9),t._uU(35," Health "),t.TgZ(36,"select",11),t.NdJ("change",function(r){return n.onStatusFilter(r.target.value)}),t.TgZ(37,"option",13),t._uU(38,"All"),t.qZA(),t.TgZ(39,"option",14),t._uU(40,"On Track"),t.qZA(),t.TgZ(41,"option",15),t._uU(42,"Due Soon"),t.qZA(),t.TgZ(43,"option",16),t._uU(44,"Overdue"),t.qZA()()()()()(),t.YNc(45,O,50,17,"section",17),t.TgZ(46,"section",7)(47,"r360-card")(48,"div",18)(49,"table",19)(50,"thead")(51,"tr",20)(52,"th",21),t._uU(53,"Tenant"),t.qZA(),t.TgZ(54,"th",21),t._uU(55,"Property"),t.qZA(),t.TgZ(56,"th",21),t._uU(57,"Unit"),t.qZA(),t.TgZ(58,"th",21),t._uU(59,"Monthly Rent"),t.qZA(),t.TgZ(60,"th",21),t._uU(61,"Pending Dues"),t.qZA(),t.TgZ(62,"th",21),t._uU(63,"Lease End"),t.qZA(),t.TgZ(64,"th",21),t._uU(65,"Health"),t.qZA(),t.TgZ(66,"th",21),t._uU(67,"Action"),t.qZA()()(),t.TgZ(68,"tbody"),t.YNc(69,D,22,19,"tr",22),t.YNc(70,M,3,0,"tr",23),t.qZA()()()()()()),2&e&&(t.xp6(1),t.Q6J("subtitle",n.subtitle),t.xp6(6),t.Oqu(n.totalTenants),t.xp6(5),t.Oqu(n.dueSoonTenants),t.xp6(5),t.Oqu(n.overdueTenants),t.xp6(5),t.Oqu(t.lcZ(23,12,n.pendingDuesTotal)),t.xp6(7),t.Q6J("value",n.search),t.xp6(3),t.Q6J("value",n.selectedProperty),t.xp6(1),t.Q6J("ngForOf",n.propertyOptions),t.xp6(3),t.Q6J("value",n.selectedStatus),t.xp6(9),t.Q6J("ngIf",n.selectedTenant),t.xp6(24),t.Q6J("ngForOf",n.filteredTenants),t.xp6(1),t.Q6J("ngIf",!n.filteredTenants.length))},dependencies:[p.sg,p.O5,d.YN,d.Kr,v.A,_.q,U.I,b.G],styles:[".tenant-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-radius:999px;background:rgb(220,252,231);color:#166534;font-size:.75rem;font-weight:600;padding:.2rem .55rem}.tenant-chip-warning[_ngcontent-%COMP%]{background:rgb(254,249,195);color:#92400e}.tenant-chip-danger[_ngcontent-%COMP%]{background:rgb(254,226,226);color:#991b1b}"]}),a})()}];let F=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[Z.m,m.Bz.forChild(N)]}),a})()}}]);